{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://event-modeling.org/schema/v1",
  "title": "Event Modeling File Format",
  "description": "A human-readable format for describing event-driven systems using the Event Modeling methodology.",
  "type": "object",
  
  "required": ["name", "timeline"],
  
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to the JSON schema"
    },
    "name": {
      "type": "string",
      "description": "Name of the modeled system"
    },
    "description": {
      "type": "string",
      "description": "Description of the system"
    },
    "version": {
      "type": "string",
      "description": "Version of the model",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    
    "timeline": {
      "type": "array",
      "description": "The chronologically ordered sequence. The order in the array determines the position on the timeline from left to right.",
      "items": {
        "oneOf": [
          { "$ref": "#/$defs/Event" },
          { "$ref": "#/$defs/StateView" },
          { "$ref": "#/$defs/Actor" },
          { "$ref": "#/$defs/Command" }
        ]
      }
    }
  },

  "$defs": {
    "Event": {
      "type": "object",
      "description": "An event represents something that has happened. Named in past tense (e.g. OrderPlaced, OrderShipped).",
      "required": ["type", "name", "tick"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "event"
        },
        "name": {
          "type": "string",
          "description": "Name of the event (past tense, e.g. 'OrderPlaced')"
        },
        "tick": {
          "type": "integer",
          "description": "Logical timestamp for ordering on the timeline"
        },
        "producedBy": {
          "type": "string",
          "description": "Reference to the command that produced this event (format: 'CommandName-Tick')"
        },
        "externalSource": {
          "type": "string",
          "description": "For external events: the source system (e.g. 'Carrier Webhook')"
        },
        "example": {
          "description": "Example payload of the event"
        }
      }
    },

    "StateView": {
      "type": "object",
      "description": "A state view (read model) built from events. Named as a noun (e.g. PendingOrders, CustomerProfile).",
      "required": ["type", "name", "tick", "sourcedFrom"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "state"
        },
        "name": {
          "type": "string",
          "description": "Name of the state view (noun, e.g. 'PendingOrders')"
        },
        "tick": {
          "type": "integer",
          "description": "Logical timestamp for ordering on the timeline"
        },
        "sourcedFrom": {
          "type": "array",
          "description": "Names of the events this state view subscribes to",
          "items": { "type": "string" }
        },
        "example": {
          "description": "Example state of the view"
        }
      }
    },

    "Actor": {
      "type": "object",
      "description": "An actor (human or system) that reads views and sends commands. Named as a role (e.g. WarehouseWorker, PaymentGateway).",
      "required": ["type", "name", "tick", "readsView", "sendsCommand"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "actor"
        },
        "name": {
          "type": "string",
          "description": "Name of the actor (role, e.g. 'WarehouseWorker')"
        },
        "tick": {
          "type": "integer",
          "description": "Logical timestamp for ordering on the timeline"
        },
        "readsView": {
          "type": "string",
          "description": "Name of the state view that the actor reads"
        },
        "sendsCommand": {
          "type": "string",
          "description": "Name of the command that the actor sends"
        }
      }
    },

    "Command": {
      "type": "object",
      "description": "A command represents an intent to do something. Named in imperative (e.g. ShipOrder, ProcessPayment).",
      "required": ["type", "name", "tick"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "command"
        },
        "name": {
          "type": "string",
          "description": "Name of the command (imperative, e.g. 'ShipOrder')"
        },
        "tick": {
          "type": "integer",
          "description": "Logical timestamp for ordering on the timeline"
        },
        "example": {
          "description": "Example payload of the command"
        }
      }
    }
  }
}
