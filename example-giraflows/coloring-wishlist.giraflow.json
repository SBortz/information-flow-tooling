{
  "$schema": "giraflow.schema.json",
  "name": "Coloring Picture Wishlist",
  "description": "A web application where children can submit text prompts describing coloring pictures they wish for. Optionally, they provide an email address for notifications. Submitted wishes go to an admin moderation queue where admins can approve or reject them. Rejected wishes trigger email notifications to the user (if email was provided). Approved wishes enter an AI image generation queue. The system generates coloring pictures using AI, tracks generation attempts, and stores images locally. Generated images appear in another admin review queue where admins can: approve the image, request regeneration with the same prompt, adjust the prompt and regenerate, or permanently reject the image. Permanently rejected images trigger email notifications. Approved images are automatically categorized by an AI system that assigns a title and tags. After categorization, users receive success notifications with a link to their image. All approved and categorized images appear in a public, browsable library organized by tags/categories. Children can browse the library, view image details (including related images), and download coloring pictures for printing. The system tracks view and download counts per image.",
  "version": "1.0.0",
  "timeline": [
    {
      "type": "state",
      "name": "WishSubmissionForm",
      "tick": 10,
      "sourcedFrom": [],
      "example": {
        "placeholder": "Describe the coloring picture you want...",
        "examples": [
          "A friendly dragon playing with butterflies",
          "A princess in a magical forest",
          "A rocket ship flying to the moon"
        ]
      }
    },
    {
      "type": "state",
      "name": "ColoringPictureLibrary",
      "tick": 15,
      "sourcedFrom": [
        "ImageApproved",
        "ImageCategorized",
        "ImageViewed",
        "ImageDownloaded"
      ],
      "example": {
        "images": [
          {
            "imageId": "img-047",
            "title": "Friendly Dinosaur Party",
            "thumbnailUrl": "/images/img-047-thumb.png",
            "tags": [
              "Animals",
              "Dinosaurs",
              "Party"
            ],
            "viewCount": 234
          },
          {
            "imageId": "img-042",
            "title": "Magical Rainbow Unicorn",
            "thumbnailUrl": "/images/img-042-thumb.png",
            "tags": [
              "Fantasy",
              "Unicorn",
              "Rainbow"
            ],
            "viewCount": 567
          },
          {
            "imageId": "img-038",
            "title": "Princess Castle",
            "thumbnailUrl": "/images/img-038-thumb.png",
            "tags": [
              "Fantasy",
              "Castle",
              "Princess"
            ],
            "viewCount": 678
          }
        ],
        "totalCount": 156,
        "availableTags": [
          "Animals",
          "Fantasy",
          "Space",
          "Nature",
          "Vehicles",
          "Dinosaurs",
          "Unicorn",
          "Party"
        ]
      }
    },
    {
      "type": "actor",
      "name": "Kid",
      "tick": 20,
      "readsView": [
        "WishSubmissionForm",
        "ColoringPictureLibrary"
      ],
      "sendsCommand": "SubmitWish",
      "role": "Kid",
      "wireframes": [
        "wireframes/kid-wish-submission-20.html"
      ]
    },
    {
      "type": "command",
      "name": "SubmitWish",
      "tick": 30,
      "example": {
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "email": "timmy@example.com"
      }
    },
    {
      "type": "event",
      "name": "WishSubmitted",
      "tick": 40,
      "producedBy": "SubmitWish-30",
      "example": {
        "wishId": "wish-001",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "email": "timmy@example.com",
        "submittedAt": "2026-01-29T10:15:00Z"
      }
    },
    {
      "type": "state",
      "name": "PendingWishes",
      "tick": 50,
      "sourcedFrom": [
        "WishSubmitted"
      ],
      "example": {
        "wishes": [
          {
            "wishId": "wish-001",
            "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
            "email": "timmy@example.com",
            "submittedAt": "2026-01-29T10:15:00Z"
          },
          {
            "wishId": "wish-002",
            "prompt": "A magical unicorn flying over a rainbow with sparkles and stars",
            "email": null,
            "submittedAt": "2026-01-29T10:12:00Z"
          }
        ],
        "totalCount": 12
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 60,
      "readsView": "PendingWishes",
      "sendsCommand": "ApproveWish",
      "role": "Admin",
      "wireframes": [
        "wireframes/admin-pending-wishes-60.html"
      ]
    },
    {
      "type": "command",
      "name": "ApproveWish",
      "tick": 70,
      "example": {
        "wishId": "wish-001"
      }
    },
    {
      "type": "event",
      "name": "WishApproved",
      "tick": 80,
      "producedBy": "ApproveWish-70",
      "example": {
        "wishId": "wish-001",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "email": "timmy@example.com",
        "approvedBy": "admin-01",
        "approvedAt": "2026-01-29T10:20:00Z"
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 90,
      "readsView": "PendingWishes",
      "sendsCommand": "RejectWish",
      "role": "Admin"
    },
    {
      "type": "command",
      "name": "RejectWish",
      "tick": 100,
      "example": {
        "wishId": "wish-003",
        "reason": "Inappropriate content"
      }
    },
    {
      "type": "event",
      "name": "WishRejected",
      "tick": 110,
      "producedBy": "RejectWish-100",
      "example": {
        "wishId": "wish-003",
        "prompt": "bad words",
        "email": "someone@example.com",
        "reason": "Inappropriate content",
        "rejectedBy": "admin-01",
        "rejectedAt": "2026-01-29T10:22:00Z"
      }
    },
    {
      "type": "state",
      "name": "PendingWishRejectionNotifications",
      "tick": 120,
      "sourcedFrom": [
        "WishRejected"
      ],
      "example": {
        "notifications": [
          {
            "wishId": "wish-003",
            "email": "someone@example.com",
            "reason": "Inappropriate content",
            "rejectedAt": "2026-01-29T10:22:00Z"
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "Notifier",
      "tick": 130,
      "readsView": "PendingWishRejectionNotifications",
      "sendsCommand": "SendWishRejectionNotification",
      "role": "System"
    },
    {
      "type": "command",
      "name": "SendWishRejectionNotification",
      "tick": 140,
      "example": {
        "wishId": "wish-003",
        "email": "someone@example.com",
        "reason": "Inappropriate content"
      }
    },
    {
      "type": "event",
      "name": "WishRejectionNotificationSent",
      "tick": 150,
      "producedBy": "SendWishRejectionNotification-140",
      "example": {
        "wishId": "wish-003",
        "email": "someone@example.com",
        "sentAt": "2026-01-29T10:23:00Z"
      }
    },
    {
      "type": "state",
      "name": "GenerationQueue",
      "tick": 160,
      "sourcedFrom": [
        "WishApproved",
        "RegenerationRequested",
        "PromptAdjustedAndRegenerationRequested"
      ],
      "example": {
        "queue": [
          {
            "wishId": "wish-001",
            "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
            "attempt": 1,
            "queuedAt": "2026-01-29T10:20:00Z"
          },
          {
            "wishId": "wish-015",
            "prompt": "A magical unicorn flying over a rainbow with sparkles and stars",
            "attempt": 3,
            "queuedAt": "2026-01-29T10:18:00Z"
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "ImageGenerator",
      "tick": 170,
      "readsView": "GenerationQueue",
      "sendsCommand": "GenerateImage",
      "role": "System"
    },
    {
      "type": "event",
      "name": "ImageGenerationStarted",
      "tick": 175,
      "producedBy": "GenerateImage-180",
      "example": {
        "wishId": "wish-001",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "attempt": 1,
        "startedAt": "2026-01-29T10:20:30Z"
      }
    },
    {
      "type": "state",
      "name": "ImagesCurrentlyGenerating",
      "tick": 176,
      "sourcedFrom": [
        "ImageGenerationStarted",
        "ImageGenerated"
      ],
      "example": {
        "images": [
          {
            "wishId": "wish-001",
            "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
            "attempt": 1,
            "startedAt": "2026-01-29T10:20:30Z"
          },
          {
            "wishId": "wish-015",
            "prompt": "A magical unicorn flying over a rainbow with sparkles and stars",
            "attempt": 3,
            "startedAt": "2026-01-29T10:19:00Z"
          }
        ],
        "totalCount": 2
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 177,
      "readsView": "ImagesCurrentlyGenerating",
      "sendsCommand": null,
      "role": "Admin"
    },
    {
      "type": "command",
      "name": "GenerateImage",
      "tick": 180,
      "example": {
        "wishId": "wish-001",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "attempt": 1
      }
    },
    {
      "type": "event",
      "name": "ImageGenerated",
      "tick": 190,
      "producedBy": "GenerateImage-180",
      "example": {
        "imageId": "img-047",
        "wishId": "wish-001",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "temporaryUrl": "https://oaidalleapiprodscus.blob.core.windows.net/...",
        "attempt": 1,
        "generatedAt": "2026-01-29T10:21:00Z"
      }
    },
    {
      "type": "state",
      "name": "ImagesToStore",
      "tick": 192,
      "sourcedFrom": [
        "ImageGenerated",
        "ImageStoredLocally"
      ],
      "example": {
        "images": [
          {
            "imageId": "img-047",
            "wishId": "wish-001",
            "temporaryUrl": "https://oaidalleapiprodscus.blob.core.windows.net/...",
            "generatedAt": "2026-01-29T10:21:00Z"
          }
        ]
      }
    },
    {
      "type": "command",
      "name": "StoreImageLocally",
      "tick": 194,
      "example": {
        "imageId": "img-047",
        "wishId": "wish-001",
        "temporaryUrl": "https://oaidalleapiprodscus.blob.core.windows.net/..."
      }
    },
    {
      "type": "event",
      "name": "ImageStoredLocally",
      "tick": 196,
      "producedBy": "StoreImageLocally-194",
      "example": {
        "imageId": "img-047",
        "wishId": "wish-001",
        "localPath": "/images/img-047.png",
        "storedAt": "2026-01-29T10:21:05Z"
      }
    },
    {
      "type": "state",
      "name": "PendingImages",
      "tick": 200,
      "sourcedFrom": [
        "ImageStoredLocally"
      ],
      "example": {
        "images": [
          {
            "imageId": "img-047",
            "wishId": "wish-001",
            "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
            "imageUrl": "/images/img-047.png",
            "attempt": 1,
            "generatedAt": "2026-01-29T10:21:00Z"
          },
          {
            "imageId": "img-048",
            "wishId": "wish-015",
            "prompt": "A magical unicorn flying over a rainbow with sparkles and stars",
            "imageUrl": "/images/img-048.png",
            "attempt": 3,
            "generatedAt": "2026-01-29T10:19:00Z"
          }
        ],
        "totalCount": 3
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 210,
      "readsView": "PendingImages",
      "sendsCommand": "ApproveImage",
      "role": "Admin",
      "wireframes": [
        "wireframes/admin-pending-images-210.html"
      ]
    },
    {
      "type": "command",
      "name": "ApproveImage",
      "tick": 220,
      "example": {
        "imageId": "img-047"
      }
    },
    {
      "type": "event",
      "name": "ImageApproved",
      "tick": 230,
      "producedBy": "ApproveImage-220",
      "example": {
        "imageId": "img-047",
        "wishId": "wish-001",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "email": "timmy@example.com",
        "imageUrl": "/images/img-047.png",
        "approvedBy": "admin-01",
        "approvedAt": "2026-01-29T10:25:00Z"
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 240,
      "readsView": "PendingImages",
      "sendsCommand": "RequestRegeneration",
      "role": "Admin"
    },
    {
      "type": "command",
      "name": "RequestRegeneration",
      "tick": 250,
      "example": {
        "imageId": "img-048"
      }
    },
    {
      "type": "event",
      "name": "RegenerationRequested",
      "tick": 260,
      "producedBy": "RequestRegeneration-250",
      "example": {
        "imageId": "img-048",
        "wishId": "wish-015",
        "prompt": "A magical unicorn flying over a rainbow with sparkles and stars",
        "previousAttempt": 3,
        "requestedBy": "admin-01",
        "requestedAt": "2026-01-29T10:24:00Z"
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 262,
      "readsView": "PendingImages",
      "sendsCommand": "AdjustPromptAndRegenerate",
      "role": "Admin"
    },
    {
      "type": "command",
      "name": "AdjustPromptAndRegenerate",
      "tick": 264,
      "example": {
        "imageId": "img-048",
        "newPrompt": "A magical unicorn with a flowing rainbow mane, flying gracefully over a colorful rainbow with sparkles and twinkling stars all around"
      }
    },
    {
      "type": "event",
      "name": "PromptAdjustedAndRegenerationRequested",
      "tick": 266,
      "producedBy": "AdjustPromptAndRegenerate-264",
      "example": {
        "imageId": "img-048",
        "wishId": "wish-015",
        "originalPrompt": "A magical unicorn flying over a rainbow with sparkles and stars",
        "newPrompt": "A magical unicorn with a flowing rainbow mane, flying gracefully over a colorful rainbow with sparkles and twinkling stars all around",
        "previousAttempt": 3,
        "adjustedBy": "admin-01",
        "requestedAt": "2026-01-29T10:24:30Z"
      }
    },
    {
      "type": "actor",
      "name": "Admin",
      "tick": 270,
      "readsView": "PendingImages",
      "sendsCommand": "RejectImagePermanently",
      "role": "Admin"
    },
    {
      "type": "command",
      "name": "RejectImagePermanently",
      "tick": 280,
      "example": {
        "imageId": "img-049",
        "reason": "Image quality too poor after multiple attempts"
      }
    },
    {
      "type": "event",
      "name": "ImagePermanentlyRejected",
      "tick": 290,
      "producedBy": "RejectImagePermanently-280",
      "example": {
        "imageId": "img-049",
        "wishId": "wish-022",
        "email": "anna@example.com",
        "reason": "Image quality too poor after multiple attempts",
        "rejectedBy": "admin-01",
        "rejectedAt": "2026-01-29T10:26:00Z"
      }
    },
    {
      "type": "state",
      "name": "PendingImageRejectionNotifications",
      "tick": 300,
      "sourcedFrom": [
        "ImagePermanentlyRejected"
      ],
      "example": {
        "notifications": [
          {
            "imageId": "img-049",
            "wishId": "wish-022",
            "email": "anna@example.com",
            "reason": "Image quality too poor after multiple attempts",
            "rejectedAt": "2026-01-29T10:26:00Z"
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "Notifier",
      "tick": 310,
      "readsView": "PendingImageRejectionNotifications",
      "sendsCommand": "SendImageRejectionNotification",
      "role": "System"
    },
    {
      "type": "command",
      "name": "SendImageRejectionNotification",
      "tick": 320,
      "example": {
        "imageId": "img-049",
        "wishId": "wish-022",
        "email": "anna@example.com",
        "reason": "Image quality too poor after multiple attempts"
      }
    },
    {
      "type": "event",
      "name": "ImageRejectionNotificationSent",
      "tick": 330,
      "producedBy": "SendImageRejectionNotification-320",
      "example": {
        "imageId": "img-049",
        "wishId": "wish-022",
        "email": "anna@example.com",
        "sentAt": "2026-01-29T10:27:00Z"
      }
    },
    {
      "type": "state",
      "name": "PendingCategorization",
      "tick": 340,
      "sourcedFrom": [
        "ImageApproved"
      ],
      "example": {
        "images": [
          {
            "imageId": "img-047",
            "wishId": "wish-001",
            "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
            "imageUrl": "/images/img-047.png",
            "approvedAt": "2026-01-29T10:25:00Z"
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "Categorizer",
      "tick": 350,
      "readsView": "PendingCategorization",
      "sendsCommand": "CategorizeImage",
      "role": "System"
    },
    {
      "type": "command",
      "name": "CategorizeImage",
      "tick": 360,
      "example": {
        "imageId": "img-047",
        "imageUrl": "/images/img-047.png",
        "prompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake"
      }
    },
    {
      "type": "event",
      "name": "ImageCategorized",
      "tick": 370,
      "producedBy": "CategorizeImage-360",
      "example": {
        "imageId": "img-047",
        "title": "Friendly Dinosaur Party",
        "tags": [
          "Animals",
          "Dinosaurs",
          "Party",
          "Birthday"
        ],
        "categorizedAt": "2026-01-29T10:26:00Z"
      }
    },
    {
      "type": "state",
      "name": "PendingSuccessNotifications",
      "tick": 380,
      "sourcedFrom": [
        "ImageCategorized"
      ],
      "example": {
        "notifications": [
          {
            "imageId": "img-047",
            "wishId": "wish-001",
            "email": "timmy@example.com",
            "title": "Friendly Dinosaur Party",
            "imageUrl": "/images/img-047.png"
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "Notifier",
      "tick": 390,
      "readsView": "PendingSuccessNotifications",
      "sendsCommand": "SendSuccessNotification",
      "role": "System"
    },
    {
      "type": "command",
      "name": "SendSuccessNotification",
      "tick": 400,
      "example": {
        "imageId": "img-047",
        "email": "timmy@example.com",
        "title": "Friendly Dinosaur Party",
        "imageUrl": "/library/img-047"
      }
    },
    {
      "type": "event",
      "name": "SuccessNotificationSent",
      "tick": 410,
      "producedBy": "SendSuccessNotification-400",
      "example": {
        "imageId": "img-047",
        "wishId": "wish-001",
        "email": "timmy@example.com",
        "sentAt": "2026-01-29T10:27:00Z"
      }
    },
    {
      "type": "state",
      "name": "ColoringPictureLibrary",
      "tick": 420,
      "sourcedFrom": [
        "ImageApproved",
        "ImageCategorized",
        "ImageViewed",
        "ImageDownloaded"
      ],
      "example": {
        "images": [
          {
            "imageId": "img-047",
            "title": "Friendly Dinosaur Party",
            "imageUrl": "/images/img-047.png",
            "thumbnailUrl": "/images/img-047-thumb.png",
            "tags": [
              "Animals",
              "Dinosaurs",
              "Party",
              "Birthday"
            ],
            "viewCount": 234,
            "downloadCount": 89,
            "publishedAt": "2026-01-29T10:26:00Z"
          },
          {
            "imageId": "img-042",
            "title": "Magical Rainbow Unicorn",
            "imageUrl": "/images/img-042.png",
            "thumbnailUrl": "/images/img-042-thumb.png",
            "tags": [
              "Fantasy",
              "Animals",
              "Unicorn",
              "Rainbow"
            ],
            "viewCount": 567,
            "downloadCount": 312,
            "publishedAt": "2026-01-29T05:00:00Z"
          },
          {
            "imageId": "img-038",
            "title": "Princess Castle",
            "imageUrl": "/images/img-038.png",
            "thumbnailUrl": "/images/img-038-thumb.png",
            "tags": [
              "Fantasy",
              "Castle",
              "Princess"
            ],
            "viewCount": 678,
            "downloadCount": 423,
            "publishedAt": "2026-01-26T14:00:00Z"
          }
        ],
        "totalCount": 156,
        "availableTags": [
          "Animals",
          "Fantasy",
          "Space",
          "Nature",
          "Vehicles",
          "Food",
          "Sports",
          "Dinosaurs",
          "Unicorn",
          "Party"
        ]
      }
    },
    {
      "type": "actor",
      "name": "Kid",
      "tick": 430,
      "readsView": "ColoringPictureLibrary",
      "sendsCommand": "ViewImage",
      "role": "Kid",
      "wireframes": [
        "wireframes/kid-library-430.html"
      ]
    },
    {
      "type": "command",
      "name": "ViewImage",
      "tick": 440,
      "example": {
        "imageId": "img-047"
      }
    },
    {
      "type": "event",
      "name": "ImageViewed",
      "tick": 450,
      "producedBy": "ViewImage-440",
      "example": {
        "imageId": "img-047",
        "viewedAt": "2026-01-29T11:00:00Z"
      }
    },
    {
      "type": "state",
      "name": "ImageDetail",
      "tick": 460,
      "sourcedFrom": [
        "ImageApproved",
        "ImageCategorized"
      ],
      "example": {
        "imageId": "img-047",
        "title": "Friendly Dinosaur Party",
        "imageUrl": "/images/img-047.png",
        "printUrl": "/images/img-047-print.png",
        "tags": [
          "Animals",
          "Dinosaurs",
          "Party",
          "Birthday"
        ],
        "originalPrompt": "A big friendly dinosaur wearing a birthday hat, surrounded by balloons and cake",
        "viewCount": 234,
        "downloadCount": 89,
        "publishedAt": "2026-01-29T10:26:00Z",
        "relatedImages": [
          {
            "imageId": "img-031",
            "title": "Dinosaur Adventure",
            "thumbnailUrl": "/images/img-031-thumb.png"
          },
          {
            "imageId": "img-025",
            "title": "Birthday Cake Party",
            "thumbnailUrl": "/images/img-025-thumb.png"
          },
          {
            "imageId": "img-019",
            "title": "Friendly T-Rex",
            "thumbnailUrl": "/images/img-019-thumb.png"
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "Kid",
      "tick": 470,
      "readsView": "ImageDetail",
      "sendsCommand": "DownloadImage",
      "role": "Kid",
      "wireframes": [
        "wireframes/kid-image-detail-470.html"
      ]
    },
    {
      "type": "command",
      "name": "DownloadImage",
      "tick": 480,
      "example": {
        "imageId": "img-047"
      }
    },
    {
      "type": "event",
      "name": "ImageDownloaded",
      "tick": 490,
      "producedBy": "DownloadImage-480",
      "example": {
        "imageId": "img-047",
        "downloadedAt": "2026-01-29T11:01:00Z"
      }
    }
  ],
  "specifications": [
    {
      "name": "SubmitWish",
      "type": "command",
      "scenarios": [
        {
          "name": "Submit wish with email",
          "steps": [
            {
              "type": "command",
              "when": {
                "prompt": "A friendly dragon playing with butterflies",
                "email": "kid@example.com"
              },
              "produces": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-101",
                    "prompt": "A friendly dragon playing with butterflies",
                    "email": "kid@example.com",
                    "submittedAt": "2026-01-29T12:00:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Submit wish without email (anonymous)",
          "steps": [
            {
              "type": "command",
              "when": {
                "prompt": "A rocket ship flying to the moon",
                "email": null
              },
              "produces": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-102",
                    "prompt": "A rocket ship flying to the moon",
                    "email": null,
                    "submittedAt": "2026-01-29T12:05:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Reject empty prompt",
          "steps": [
            {
              "type": "command",
              "when": {
                "prompt": "",
                "email": null
              },
              "fails": "Prompt cannot be empty"
            }
          ]
        }
      ]
    },
    {
      "name": "ApproveWish",
      "type": "command",
      "scenarios": [
        {
          "name": "Approve pending wish",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-201",
                    "prompt": "A princess in a magical forest",
                    "email": "princess@example.com",
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "wishId": "wish-201"
              },
              "produces": [
                {
                  "event": "WishApproved",
                  "data": {
                    "wishId": "wish-201",
                    "prompt": "A princess in a magical forest",
                    "email": "princess@example.com",
                    "approvedBy": "admin-01",
                    "approvedAt": "2026-01-29T10:10:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Cannot approve non-existent wish",
          "steps": [
            {
              "type": "command",
              "when": {
                "wishId": "wish-999"
              },
              "fails": "Wish not found"
            }
          ]
        },
        {
          "name": "Cannot approve already processed wish",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-202",
                    "prompt": "A cat astronaut",
                    "email": null,
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                },
                {
                  "event": "WishApproved",
                  "data": {
                    "wishId": "wish-202",
                    "prompt": "A cat astronaut",
                    "email": null,
                    "approvedBy": "admin-01",
                    "approvedAt": "2026-01-29T10:05:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "wishId": "wish-202"
              },
              "fails": "Wish already processed"
            }
          ]
        }
      ]
    },
    {
      "name": "RejectWish",
      "type": "command",
      "scenarios": [
        {
          "name": "Reject wish with reason",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-301",
                    "prompt": "inappropriate content",
                    "email": "someone@example.com",
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "wishId": "wish-301",
                "reason": "Inappropriate content"
              },
              "produces": [
                {
                  "event": "WishRejected",
                  "data": {
                    "wishId": "wish-301",
                    "prompt": "inappropriate content",
                    "email": "someone@example.com",
                    "reason": "Inappropriate content",
                    "rejectedBy": "admin-01",
                    "rejectedAt": "2026-01-29T10:10:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Reject wish without reason",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-302",
                    "prompt": "something unclear",
                    "email": null,
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "wishId": "wish-302",
                "reason": null
              },
              "produces": [
                {
                  "event": "WishRejected",
                  "data": {
                    "wishId": "wish-302",
                    "prompt": "something unclear",
                    "email": null,
                    "reason": null,
                    "rejectedBy": "admin-01",
                    "rejectedAt": "2026-01-29T10:10:00Z"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ApproveImage",
      "type": "command",
      "scenarios": [
        {
          "name": "Approve generated image",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-401",
                    "prompt": "A happy sun with sunglasses",
                    "email": "sunny@example.com",
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                },
                {
                  "event": "WishApproved",
                  "data": {
                    "wishId": "wish-401",
                    "prompt": "A happy sun with sunglasses",
                    "email": "sunny@example.com",
                    "approvedBy": "admin-01",
                    "approvedAt": "2026-01-29T10:05:00Z"
                  }
                },
                {
                  "event": "ImageGenerated",
                  "data": {
                    "imageId": "img-401",
                    "wishId": "wish-401",
                    "prompt": "A happy sun with sunglasses",
                    "imageUrl": "/images/img-401.png",
                    "attempt": 1,
                    "generatedAt": "2026-01-29T10:06:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-401"
              },
              "produces": [
                {
                  "event": "ImageApproved",
                  "data": {
                    "imageId": "img-401",
                    "wishId": "wish-401",
                    "prompt": "A happy sun with sunglasses",
                    "email": "sunny@example.com",
                    "imageUrl": "/images/img-401.png",
                    "approvedBy": "admin-01",
                    "approvedAt": "2026-01-29T10:10:00Z"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "RequestRegeneration",
      "type": "command",
      "scenarios": [
        {
          "name": "Request regeneration of poor quality image",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "ImageGenerated",
                  "data": {
                    "imageId": "img-501",
                    "wishId": "wish-501",
                    "prompt": "A dancing elephant",
                    "imageUrl": "/images/img-501.png",
                    "attempt": 1,
                    "generatedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-501"
              },
              "produces": [
                {
                  "event": "RegenerationRequested",
                  "data": {
                    "imageId": "img-501",
                    "wishId": "wish-501",
                    "prompt": "A dancing elephant",
                    "previousAttempt": 1,
                    "requestedBy": "admin-01",
                    "requestedAt": "2026-01-29T10:05:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Regeneration after multiple attempts",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "ImageGenerated",
                  "data": {
                    "imageId": "img-502",
                    "wishId": "wish-502",
                    "prompt": "A flying fish",
                    "imageUrl": "/images/img-502.png",
                    "attempt": 3,
                    "generatedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-502"
              },
              "produces": [
                {
                  "event": "RegenerationRequested",
                  "data": {
                    "imageId": "img-502",
                    "wishId": "wish-502",
                    "prompt": "A flying fish",
                    "previousAttempt": 3,
                    "requestedBy": "admin-01",
                    "requestedAt": "2026-01-29T10:05:00Z"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "AdjustPromptAndRegenerate",
      "type": "command",
      "scenarios": [
        {
          "name": "Adjust prompt and request regeneration",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "ImageGenerated",
                  "data": {
                    "imageId": "img-510",
                    "wishId": "wish-510",
                    "prompt": "A robot",
                    "imageUrl": "/images/img-510.png",
                    "attempt": 2,
                    "generatedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-510",
                "newPrompt": "A friendly robot with big eyes, waving hello, standing in a garden with flowers"
              },
              "produces": [
                {
                  "event": "PromptAdjustedAndRegenerationRequested",
                  "data": {
                    "imageId": "img-510",
                    "wishId": "wish-510",
                    "originalPrompt": "A robot",
                    "newPrompt": "A friendly robot with big eyes, waving hello, standing in a garden with flowers",
                    "previousAttempt": 2,
                    "adjustedBy": "admin-01",
                    "requestedAt": "2026-01-29T10:05:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Cannot adjust prompt for non-existent image",
          "steps": [
            {
              "type": "command",
              "when": {
                "imageId": "img-999",
                "newPrompt": "Some new prompt"
              },
              "fails": "Image not found"
            }
          ]
        }
      ]
    },
    {
      "name": "RejectImagePermanently",
      "type": "command",
      "scenarios": [
        {
          "name": "Permanently reject image after failed attempts",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "WishSubmitted",
                  "data": {
                    "wishId": "wish-601",
                    "prompt": "Abstract concept that cannot be drawn",
                    "email": "user@example.com",
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                },
                {
                  "event": "ImageGenerated",
                  "data": {
                    "imageId": "img-601",
                    "wishId": "wish-601",
                    "prompt": "Abstract concept that cannot be drawn",
                    "imageUrl": "/images/img-601.png",
                    "attempt": 5,
                    "generatedAt": "2026-01-29T10:30:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-601",
                "reason": "Unable to generate suitable image after multiple attempts"
              },
              "produces": [
                {
                  "event": "ImagePermanentlyRejected",
                  "data": {
                    "imageId": "img-601",
                    "wishId": "wish-601",
                    "email": "user@example.com",
                    "reason": "Unable to generate suitable image after multiple attempts",
                    "rejectedBy": "admin-01",
                    "rejectedAt": "2026-01-29T10:35:00Z"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "CategorizeImage",
      "type": "command",
      "scenarios": [
        {
          "name": "Categorize image with multiple tags",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "ImageApproved",
                  "data": {
                    "imageId": "img-701",
                    "wishId": "wish-701",
                    "prompt": "A dinosaur astronaut on Mars",
                    "email": "space@example.com",
                    "imageUrl": "/images/img-701.png",
                    "approvedBy": "admin-01",
                    "approvedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-701",
                "imageUrl": "/images/img-701.png",
                "prompt": "A dinosaur astronaut on Mars"
              },
              "produces": [
                {
                  "event": "ImageCategorized",
                  "data": {
                    "imageId": "img-701",
                    "title": "Dinosaur Astronaut on Mars",
                    "tags": [
                      "Animals",
                      "Dinosaurs",
                      "Space",
                      "Planets"
                    ],
                    "categorizedAt": "2026-01-29T10:01:00Z"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "SendSuccessNotification",
      "type": "command",
      "scenarios": [
        {
          "name": "Send notification when email provided",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "ImageCategorized",
                  "data": {
                    "imageId": "img-801",
                    "title": "Happy Puppy",
                    "tags": [
                      "Animals",
                      "Dogs"
                    ],
                    "categorizedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-801",
                "email": "dogfan@example.com",
                "title": "Happy Puppy",
                "imageUrl": "/library/img-801"
              },
              "produces": [
                {
                  "event": "SuccessNotificationSent",
                  "data": {
                    "imageId": "img-801",
                    "wishId": "wish-801",
                    "email": "dogfan@example.com",
                    "sentAt": "2026-01-29T10:01:00Z"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Skip notification when no email provided",
          "steps": [
            {
              "type": "events-only",
              "events": [
                {
                  "event": "ImageCategorized",
                  "data": {
                    "imageId": "img-802",
                    "title": "Sleepy Cat",
                    "tags": [
                      "Animals",
                      "Cats"
                    ],
                    "categorizedAt": "2026-01-29T10:00:00Z"
                  }
                }
              ]
            },
            {
              "type": "command",
              "when": {
                "imageId": "img-802",
                "email": null,
                "title": "Sleepy Cat",
                "imageUrl": "/library/img-802"
              },
              "fails": "No email provided - notification skipped"
            }
          ]
        }
      ]
    },
    {
      "name": "PendingWishes",
      "type": "state",
      "scenarios": [
        {
          "name": "New wish appears in pending list",
          "initialState": {
            "wishes": [],
            "totalCount": 0
          },
          "steps": [
            {
              "given": {
                "event": "WishSubmitted",
                "data": {
                  "wishId": "wish-901",
                  "prompt": "A rainbow butterfly",
                  "email": "butterfly@example.com",
                  "submittedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "wishes": [
                  {
                    "wishId": "wish-901",
                    "prompt": "A rainbow butterfly",
                    "email": "butterfly@example.com",
                    "submittedAt": "2026-01-29T10:00:00Z"
                  }
                ],
                "totalCount": 1
              }
            }
          ]
        },
        {
          "name": "Approved wish removed from pending list",
          "initialState": {
            "wishes": [
              {
                "wishId": "wish-902",
                "prompt": "A smiling cloud",
                "email": null,
                "submittedAt": "2026-01-29T10:00:00Z"
              }
            ],
            "totalCount": 1
          },
          "steps": [
            {
              "given": {
                "event": "WishApproved",
                "data": {
                  "wishId": "wish-902",
                  "prompt": "A smiling cloud",
                  "email": null,
                  "approvedBy": "admin-01",
                  "approvedAt": "2026-01-29T10:05:00Z"
                }
              },
              "then": {
                "wishes": [],
                "totalCount": 0
              }
            }
          ]
        },
        {
          "name": "Rejected wish removed from pending list",
          "initialState": {
            "wishes": [
              {
                "wishId": "wish-903",
                "prompt": "bad content",
                "email": "bad@example.com",
                "submittedAt": "2026-01-29T10:00:00Z"
              }
            ],
            "totalCount": 1
          },
          "steps": [
            {
              "given": {
                "event": "WishRejected",
                "data": {
                  "wishId": "wish-903",
                  "prompt": "bad content",
                  "email": "bad@example.com",
                  "reason": "Inappropriate",
                  "rejectedBy": "admin-01",
                  "rejectedAt": "2026-01-29T10:05:00Z"
                }
              },
              "then": {
                "wishes": [],
                "totalCount": 0
              }
            }
          ]
        }
      ]
    },
    {
      "name": "GenerationQueue",
      "type": "state",
      "scenarios": [
        {
          "name": "Approved wish added to generation queue",
          "initialState": {
            "queue": []
          },
          "steps": [
            {
              "given": {
                "event": "WishApproved",
                "data": {
                  "wishId": "wish-1001",
                  "prompt": "A pirate ship",
                  "email": "pirate@example.com",
                  "approvedBy": "admin-01",
                  "approvedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "queue": [
                  {
                    "wishId": "wish-1001",
                    "prompt": "A pirate ship",
                    "attempt": 1,
                    "queuedAt": "2026-01-29T10:00:00Z"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "Regeneration request adds to queue with incremented attempt",
          "initialState": {
            "queue": []
          },
          "steps": [
            {
              "given": {
                "event": "RegenerationRequested",
                "data": {
                  "imageId": "img-1002",
                  "wishId": "wish-1002",
                  "prompt": "A ninja turtle",
                  "previousAttempt": 2,
                  "requestedBy": "admin-01",
                  "requestedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "queue": [
                  {
                    "wishId": "wish-1002",
                    "prompt": "A ninja turtle",
                    "attempt": 3,
                    "queuedAt": "2026-01-29T10:00:00Z"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "Adjusted prompt adds to queue with new prompt and incremented attempt",
          "initialState": {
            "queue": []
          },
          "steps": [
            {
              "given": {
                "event": "PromptAdjustedAndRegenerationRequested",
                "data": {
                  "imageId": "img-1003",
                  "wishId": "wish-1003",
                  "originalPrompt": "A robot",
                  "newPrompt": "A friendly robot with big eyes waving hello",
                  "previousAttempt": 2,
                  "adjustedBy": "admin-01",
                  "requestedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "queue": [
                  {
                    "wishId": "wish-1003",
                    "prompt": "A friendly robot with big eyes waving hello",
                    "attempt": 3,
                    "queuedAt": "2026-01-29T10:00:00Z"
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ColoringPictureLibrary",
      "type": "state",
      "scenarios": [
        {
          "name": "Image appears in library after categorization",
          "initialState": {
            "images": [],
            "totalCount": 0,
            "availableTags": []
          },
          "steps": [
            {
              "given": {
                "event": "ImageApproved",
                "data": {
                  "imageId": "img-1101",
                  "wishId": "wish-1101",
                  "prompt": "A superhero dog",
                  "email": "hero@example.com",
                  "imageUrl": "/images/img-1101.png",
                  "approvedBy": "admin-01",
                  "approvedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "images": [
                  {
                    "imageId": "img-1101",
                    "title": null,
                    "imageUrl": "/images/img-1101.png",
                    "tags": [],
                    "viewCount": 0,
                    "downloadCount": 0,
                    "publishedAt": "2026-01-29T10:00:00Z"
                  }
                ],
                "totalCount": 1,
                "availableTags": []
              }
            },
            {
              "given": {
                "event": "ImageCategorized",
                "data": {
                  "imageId": "img-1101",
                  "title": "Superhero Dog",
                  "tags": [
                    "Animals",
                    "Dogs",
                    "Superheroes"
                  ],
                  "categorizedAt": "2026-01-29T10:01:00Z"
                }
              },
              "then": {
                "images": [
                  {
                    "imageId": "img-1101",
                    "title": "Superhero Dog",
                    "imageUrl": "/images/img-1101.png",
                    "tags": [
                      "Animals",
                      "Dogs",
                      "Superheroes"
                    ],
                    "viewCount": 0,
                    "downloadCount": 0,
                    "publishedAt": "2026-01-29T10:00:00Z"
                  }
                ],
                "totalCount": 1,
                "availableTags": [
                  "Animals",
                  "Dogs",
                  "Superheroes"
                ]
              }
            }
          ]
        },
        {
          "name": "View count increases when image viewed",
          "initialState": {
            "images": [
              {
                "imageId": "img-1102",
                "title": "Racing Car",
                "imageUrl": "/images/img-1102.png",
                "tags": [
                  "Vehicles",
                  "Cars"
                ],
                "viewCount": 10,
                "downloadCount": 5,
                "publishedAt": "2026-01-28T10:00:00Z"
              }
            ],
            "totalCount": 1,
            "availableTags": [
              "Vehicles",
              "Cars"
            ]
          },
          "steps": [
            {
              "given": {
                "event": "ImageViewed",
                "data": {
                  "imageId": "img-1102",
                  "viewedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "images": [
                  {
                    "imageId": "img-1102",
                    "title": "Racing Car",
                    "imageUrl": "/images/img-1102.png",
                    "tags": [
                      "Vehicles",
                      "Cars"
                    ],
                    "viewCount": 11,
                    "downloadCount": 5,
                    "publishedAt": "2026-01-28T10:00:00Z"
                  }
                ],
                "totalCount": 1,
                "availableTags": [
                  "Vehicles",
                  "Cars"
                ]
              }
            }
          ]
        },
        {
          "name": "Download count increases when image downloaded",
          "initialState": {
            "images": [
              {
                "imageId": "img-1103",
                "title": "Space Rocket",
                "imageUrl": "/images/img-1103.png",
                "tags": [
                  "Space",
                  "Vehicles"
                ],
                "viewCount": 50,
                "downloadCount": 20,
                "publishedAt": "2026-01-27T10:00:00Z"
              }
            ],
            "totalCount": 1,
            "availableTags": [
              "Space",
              "Vehicles"
            ]
          },
          "steps": [
            {
              "given": {
                "event": "ImageDownloaded",
                "data": {
                  "imageId": "img-1103",
                  "downloadedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "images": [
                  {
                    "imageId": "img-1103",
                    "title": "Space Rocket",
                    "imageUrl": "/images/img-1103.png",
                    "tags": [
                      "Space",
                      "Vehicles"
                    ],
                    "viewCount": 50,
                    "downloadCount": 21,
                    "publishedAt": "2026-01-27T10:00:00Z"
                  }
                ],
                "totalCount": 1,
                "availableTags": [
                  "Space",
                  "Vehicles"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "PendingImages",
      "type": "state",
      "scenarios": [
        {
          "name": "Generated image appears in pending list",
          "initialState": {
            "images": [],
            "totalCount": 0
          },
          "steps": [
            {
              "given": {
                "event": "ImageGenerated",
                "data": {
                  "imageId": "img-1201",
                  "wishId": "wish-1201",
                  "prompt": "A wizard cat",
                  "imageUrl": "/images/img-1201.png",
                  "attempt": 1,
                  "generatedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "images": [
                  {
                    "imageId": "img-1201",
                    "wishId": "wish-1201",
                    "prompt": "A wizard cat",
                    "imageUrl": "/images/img-1201.png",
                    "attempt": 1,
                    "generatedAt": "2026-01-29T10:00:00Z"
                  }
                ],
                "totalCount": 1
              }
            }
          ]
        },
        {
          "name": "Approved image removed from pending list",
          "initialState": {
            "images": [
              {
                "imageId": "img-1202",
                "wishId": "wish-1202",
                "prompt": "A friendly ghost",
                "imageUrl": "/images/img-1202.png",
                "attempt": 1,
                "generatedAt": "2026-01-29T10:00:00Z"
              }
            ],
            "totalCount": 1
          },
          "steps": [
            {
              "given": {
                "event": "ImageApproved",
                "data": {
                  "imageId": "img-1202",
                  "wishId": "wish-1202",
                  "prompt": "A friendly ghost",
                  "email": null,
                  "imageUrl": "/images/img-1202.png",
                  "approvedBy": "admin-01",
                  "approvedAt": "2026-01-29T10:05:00Z"
                }
              },
              "then": {
                "images": [],
                "totalCount": 0
              }
            }
          ]
        },
        {
          "name": "Regeneration request removes image from pending list",
          "initialState": {
            "images": [
              {
                "imageId": "img-1203",
                "wishId": "wish-1203",
                "prompt": "A dancing robot",
                "imageUrl": "/images/img-1203.png",
                "attempt": 2,
                "generatedAt": "2026-01-29T10:00:00Z"
              }
            ],
            "totalCount": 1
          },
          "steps": [
            {
              "given": {
                "event": "RegenerationRequested",
                "data": {
                  "imageId": "img-1203",
                  "wishId": "wish-1203",
                  "prompt": "A dancing robot",
                  "previousAttempt": 2,
                  "requestedBy": "admin-01",
                  "requestedAt": "2026-01-29T10:05:00Z"
                }
              },
              "then": {
                "images": [],
                "totalCount": 0
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ImagesCurrentlyGenerating",
      "type": "state",
      "scenarios": [
        {
          "name": "Image appears when generation starts",
          "initialState": {
            "images": [],
            "totalCount": 0
          },
          "steps": [
            {
              "given": {
                "event": "ImageGenerationStarted",
                "data": {
                  "wishId": "wish-1301",
                  "prompt": "A magical forest with glowing mushrooms",
                  "attempt": 1,
                  "startedAt": "2026-01-29T10:00:00Z"
                }
              },
              "then": {
                "images": [
                  {
                    "wishId": "wish-1301",
                    "prompt": "A magical forest with glowing mushrooms",
                    "attempt": 1,
                    "startedAt": "2026-01-29T10:00:00Z"
                  }
                ],
                "totalCount": 1
              }
            }
          ]
        },
        {
          "name": "Image disappears when generation completes",
          "initialState": {
            "images": [
              {
                "wishId": "wish-1302",
                "prompt": "A friendly robot helping in the kitchen",
                "attempt": 1,
                "startedAt": "2026-01-29T10:00:00Z"
              }
            ],
            "totalCount": 1
          },
          "steps": [
            {
              "given": {
                "event": "ImageGenerated",
                "data": {
                  "imageId": "img-1302",
                  "wishId": "wish-1302",
                  "prompt": "A friendly robot helping in the kitchen",
                  "imageUrl": "/images/img-1302.png",
                  "attempt": 1,
                  "generatedAt": "2026-01-29T10:01:00Z"
                }
              },
              "then": {
                "images": [],
                "totalCount": 0
              }
            }
          ]
        },
        {
          "name": "Multiple images can be generating simultaneously",
          "initialState": {
            "images": [
              {
                "wishId": "wish-1303",
                "prompt": "A sleeping dragon on a mountain",
                "attempt": 2,
                "startedAt": "2026-01-29T10:00:00Z"
              }
            ],
            "totalCount": 1
          },
          "steps": [
            {
              "given": {
                "event": "ImageGenerationStarted",
                "data": {
                  "wishId": "wish-1304",
                  "prompt": "A pirate parrot with a treasure map",
                  "attempt": 1,
                  "startedAt": "2026-01-29T10:00:30Z"
                }
              },
              "then": {
                "images": [
                  {
                    "wishId": "wish-1303",
                    "prompt": "A sleeping dragon on a mountain",
                    "attempt": 2,
                    "startedAt": "2026-01-29T10:00:00Z"
                  },
                  {
                    "wishId": "wish-1304",
                    "prompt": "A pirate parrot with a treasure map",
                    "attempt": 1,
                    "startedAt": "2026-01-29T10:00:30Z"
                  }
                ],
                "totalCount": 2
              }
            }
          ]
        }
      ]
    }
  ]
}