{
  "$schema": "../information-flow.schema.json",
  "name": "Library Management System",
  "description": "A library management system with borrowing, returns, reservations and automatic reminders",
  "version": "1.0.0",

  "timeline": [
    
    {
      "type": "event",
      "name": "BookAddedToCatalog",
      "tick": 10,
      "example": {
        "bookId": "book-001",
        "isbn": "978-3-16-148410-0",
        "title": "Clean Code",
        "author": "Robert C. Martin",
        "addedAt": "2026-01-01T09:00:00Z"
      }
    },

    {
      "type": "state",
      "name": "AvailableBooks",
      "tick": 20,
      "sourcedFrom": ["BookAddedToCatalog", "BookBorrowed", "BookReturned"],
      "example": {
        "books": [
          { "bookId": "book-001", "title": "Clean Code", "author": "Robert C. Martin", "available": true }
        ]
      }
    },
    {
      "type": "actor",
      "name": "LibraryUser",
      "tick": 30,
      "readsView": "AvailableBooks",
      "sendsCommand": "BorrowBook"
    },
    {
      "type": "command",
      "name": "BorrowBook",
      "tick": 40,
      "example": {
        "bookId": "book-001",
        "userId": "user-123",
        "borrowDate": "2026-01-15T10:00:00Z"
      }
    },
    {
      "type": "event",
      "name": "BookBorrowed",
      "tick": 50,
      "producedBy": "BorrowBook-40",
      "example": {
        "loanId": "loan-001",
        "bookId": "book-001",
        "userId": "user-123",
        "borrowedAt": "2026-01-15T10:00:00Z",
        "dueDate": "2026-01-29T23:59:59Z"
      }
    },

    {
      "type": "state",
      "name": "UserLoans",
      "tick": 60,
      "sourcedFrom": ["BookBorrowed", "BookReturned"],
      "example": {
        "userId": "user-123",
        "loans": [
          { "loanId": "loan-001", "bookId": "book-001", "title": "Clean Code", "dueDate": "2026-01-29T23:59:59Z" }
        ]
      }
    },
    {
      "type": "actor",
      "name": "LibraryUser",
      "tick": 70,
      "readsView": "UserLoans",
      "sendsCommand": "ReturnBook"
    },
    {
      "type": "command",
      "name": "ReturnBook",
      "tick": 80,
      "example": {
        "loanId": "loan-001",
        "bookId": "book-001",
        "userId": "user-123"
      }
    },
    {
      "type": "event",
      "name": "BookReturned",
      "tick": 90,
      "producedBy": "ReturnBook-80",
      "example": {
        "loanId": "loan-001",
        "bookId": "book-001",
        "userId": "user-123",
        "returnedAt": "2026-01-22T14:30:00Z",
        "wasOverdue": false
      }
    },

    {
      "type": "state",
      "name": "BookAvailability",
      "tick": 100,
      "sourcedFrom": ["BookBorrowed", "BookReturned", "BookReserved", "ReservationFulfilled"],
      "example": {
        "bookId": "book-002",
        "title": "Domain-Driven Design",
        "status": "borrowed",
        "currentBorrower": "user-456",
        "dueDate": "2026-01-25T23:59:59Z",
        "reservations": []
      }
    },
    {
      "type": "actor",
      "name": "LibraryUser",
      "tick": 110,
      "readsView": "BookAvailability",
      "sendsCommand": "ReserveBook"
    },
    {
      "type": "command",
      "name": "ReserveBook",
      "tick": 120,
      "example": {
        "bookId": "book-002",
        "userId": "user-123",
        "reservationDate": "2026-01-20T11:00:00Z"
      }
    },
    {
      "type": "event",
      "name": "BookReserved",
      "tick": 130,
      "producedBy": "ReserveBook-120",
      "example": {
        "reservationId": "res-001",
        "bookId": "book-002",
        "userId": "user-123",
        "reservedAt": "2026-01-20T11:00:00Z",
        "queuePosition": 1
      }
    },

    {
      "type": "state",
      "name": "ReservationQueue",
      "tick": 140,
      "sourcedFrom": ["BookReserved", "ReservationFulfilled", "ReservationCancelled"],
      "example": {
        "bookId": "book-002",
        "title": "Domain-Driven Design",
        "reservations": [
          { "reservationId": "res-001", "userId": "user-123", "position": 1, "reservedAt": "2026-01-20T11:00:00Z" }
        ]
      }
    },

    {
      "type": "event",
      "name": "BookReturned",
      "tick": 150,
      "producedBy": "ReturnBook-145",
      "example": {
        "loanId": "loan-002",
        "bookId": "book-002",
        "userId": "user-456",
        "returnedAt": "2026-01-25T16:00:00Z",
        "wasOverdue": false
      }
    },
    {
      "type": "state",
      "name": "PendingReservations",
      "tick": 160,
      "sourcedFrom": ["BookReturned", "BookReserved"],
      "example": {
        "reservations": [
          { "reservationId": "res-001", "bookId": "book-002", "userId": "user-123", "bookTitle": "Domain-Driven Design" }
        ]
      }
    },
    {
      "type": "actor",
      "name": "Librarian",
      "tick": 170,
      "readsView": "PendingReservations",
      "sendsCommand": "FulfillReservation"
    },
    {
      "type": "command",
      "name": "FulfillReservation",
      "tick": 180,
      "example": {
        "reservationId": "res-001",
        "bookId": "book-002",
        "userId": "user-123"
      }
    },
    {
      "type": "event",
      "name": "ReservationFulfilled",
      "tick": 190,
      "producedBy": "FulfillReservation-180",
      "example": {
        "reservationId": "res-001",
        "bookId": "book-002",
        "userId": "user-123",
        "notifiedAt": "2026-01-25T16:30:00Z",
        "pickupDeadline": "2026-01-28T23:59:59Z"
      }
    },

    {
      "type": "event",
      "name": "BookBorrowed",
      "tick": 200,
      "producedBy": "BorrowBook-195",
      "example": {
        "loanId": "loan-003",
        "bookId": "book-003",
        "userId": "user-789",
        "borrowedAt": "2026-01-01T10:00:00Z",
        "dueDate": "2026-01-15T23:59:59Z"
      }
    },
    {
      "type": "state",
      "name": "OverdueLoans",
      "tick": 210,
      "sourcedFrom": ["BookBorrowed", "BookReturned", "OverdueReminderSent"],
      "example": {
        "overdueLoans": [
          { 
            "loanId": "loan-003", 
            "bookId": "book-003", 
            "bookTitle": "The Pragmatic Programmer",
            "userId": "user-789", 
            "userName": "John Doe",
            "userEmail": "max@example.com",
            "dueDate": "2026-01-15T23:59:59Z",
            "daysOverdue": 7,
            "lastReminderSent": null
          }
        ]
      }
    },
    {
      "type": "actor",
      "name": "System",
      "tick": 220,
      "readsView": "OverdueLoans",
      "sendsCommand": "SendOverdueReminder"
    },
    {
      "type": "command",
      "name": "SendOverdueReminder",
      "tick": 230,
      "example": {
        "loanId": "loan-003",
        "userId": "user-789",
        "userEmail": "max@example.com",
        "bookTitle": "The Pragmatic Programmer",
        "daysOverdue": 7,
        "fineAmount": 3.50
      }
    },
    {
      "type": "event",
      "name": "OverdueReminderSent",
      "tick": 240,
      "producedBy": "SendOverdueReminder-230",
      "example": {
        "reminderId": "reminder-001",
        "loanId": "loan-003",
        "userId": "user-789",
        "sentAt": "2026-01-22T08:00:00Z",
        "reminderType": "email",
        "fineAmount": 3.50,
        "message": "Please return the book 'The Pragmatic Programmer'. Current fine: $3.50"
      }
    },

    {
      "type": "state",
      "name": "UserNotifications",
      "tick": 250,
      "sourcedFrom": ["OverdueReminderSent", "ReservationFulfilled"],
      "example": {
        "userId": "user-789",
        "notifications": [
          {
            "type": "overdue_reminder",
            "message": "Please return the book 'The Pragmatic Programmer'. Current fine: $3.50",
            "receivedAt": "2026-01-22T08:00:00Z"
          }
        ]
      }
    },

    {
      "type": "state",
      "name": "LibraryStatistics",
      "tick": 260,
      "sourcedFrom": ["BookBorrowed", "BookReturned", "BookReserved", "OverdueReminderSent"],
      "example": {
        "totalLoans": 156,
        "activeLoans": 42,
        "overdueLoans": 5,
        "reservationsWaiting": 12,
        "totalFinesCollected": 245.50
      }
    }
  ]
}
