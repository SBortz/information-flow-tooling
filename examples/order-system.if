{
  "$schema": "../information-flow.schema.json",
  "name": "Order Management System",
  "description": "A simple order system demonstrating the Information Flow format",
  "version": "1.0.0",
  
  "timeline": [
    {
      "type": "event",
      "name": "ProductAddedToCart",
      "tick": 10,
      "example": {
        "cartId": "cart-123",
        "productId": "prod-456",
        "productName": "Wireless Keyboard",
        "quantity": 1,
        "unitPrice": 79.99,
        "addedAt": "2024-01-15T10:30:00Z"
      }
    },
    {
      "type": "event",
      "name": "CartUpdated",
      "tick": 20,
      "example": {
        "cartId": "cart-123",
        "totalItems": 2,
        "totalAmount": 159.98,
        "updatedAt": "2024-01-15T10:32:00Z"
      }
    },
    {
      "type": "state",
      "name": "ShoppingCart",
      "tick": 30,
      "sourcedFrom": ["ProductAddedToCart", "CartUpdated"],
      "example": {
        "cartId": "cart-123",
        "customerId": "cust-789",
        "items": [
          { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 },
          { "productId": "prod-457", "name": "Mouse Pad", "quantity": 1, "price": 19.99 }
        ],
        "totalAmount": 99.98
      },
      "scenarios": [
        {
          "name": "Cart with one item",
          "given": [
            {
              "event": "ProductAddedToCart",
              "data": {
                "cartId": "cart-123",
                "productId": "prod-456",
                "productName": "Wireless Keyboard",
                "quantity": 1,
                "unitPrice": 79.99,
                "addedAt": "2024-01-15T10:30:00Z"
              }
            }
          ],
          "then": {
            "cartId": "cart-123",
            "customerId": "cust-789",
            "items": [
              { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
            ],
            "totalAmount": 79.99
          }
        },
        {
          "name": "Cart with multiple items",
          "given": [
            {
              "event": "ProductAddedToCart",
              "data": {
                "cartId": "cart-123",
                "productId": "prod-456",
                "productName": "Wireless Keyboard",
                "quantity": 1,
                "unitPrice": 79.99,
                "addedAt": "2024-01-15T10:30:00Z"
              }
            },
            {
              "event": "ProductAddedToCart",
              "data": {
                "cartId": "cart-123",
                "productId": "prod-457",
                "productName": "Mouse Pad",
                "quantity": 1,
                "unitPrice": 19.99,
                "addedAt": "2024-01-15T10:31:00Z"
              }
            },
            {
              "event": "CartUpdated",
              "data": {
                "cartId": "cart-123",
                "totalItems": 2,
                "totalAmount": 99.98,
                "updatedAt": "2024-01-15T10:32:00Z"
              }
            }
          ],
          "then": {
            "cartId": "cart-123",
            "customerId": "cust-789",
            "items": [
              { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 },
              { "productId": "prod-457", "name": "Mouse Pad", "quantity": 1, "price": 19.99 }
            ],
            "totalAmount": 99.98
          }
        }
      ]
    },
    {
      "type": "actor",
      "name": "Customer",
      "tick": 40,
      "readsView": "ShoppingCart",
      "sendsCommand": "PlaceOrder"
    },
    {
      "type": "command",
      "name": "PlaceOrder",
      "tick": 50,
      "example": {
        "cartId": "cart-123",
        "customerId": "cust-789",
        "shippingAddress": {
          "street": "123 Main Street",
          "city": "Berlin",
          "zip": "10115"
        },
        "paymentMethod": "credit_card"
      },
      "scenarios": [
        {
          "name": "Successful order with filled cart",
          "given": [
            {
              "event": "ProductAddedToCart",
              "data": {
                "cartId": "cart-123",
                "productId": "prod-456",
                "productName": "Wireless Keyboard",
                "quantity": 1,
                "unitPrice": 79.99,
                "addedAt": "2024-01-15T10:30:00Z"
              }
            },
            {
              "event": "CartUpdated",
              "data": {
                "cartId": "cart-123",
                "totalItems": 1,
                "totalAmount": 79.99,
                "updatedAt": "2024-01-15T10:32:00Z"
              }
            }
          ],
          "when": {
            "cartId": "cart-123",
            "customerId": "cust-789",
            "shippingAddress": {
              "street": "123 Main Street",
              "city": "Berlin",
              "zip": "10115"
            },
            "paymentMethod": "credit_card"
          },
          "then": {
            "produces": [
              {
                "event": "OrderCreated",
                "data": {
                  "orderId": "order-001",
                  "customerId": "cust-789",
                  "items": [
                    { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                  ],
                  "totalAmount": 79.99,
                  "status": "pending",
                  "createdAt": "2024-01-15T10:35:00Z"
                }
              }
            ]
          }
        },
        {
          "name": "Reject empty cart",
          "given": [],
          "when": {
            "cartId": "cart-123",
            "customerId": "cust-789",
            "shippingAddress": {
              "street": "123 Main Street",
              "city": "Berlin",
              "zip": "10115"
            },
            "paymentMethod": "credit_card"
          },
          "then": {
            "fails": "Cart is empty"
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "OrderCreated",
      "tick": 60,
      "producedBy": "PlaceOrder-50",
      "example": {
        "orderId": "order-001",
        "customerId": "cust-789",
        "items": [
          { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
        ],
        "totalAmount": 79.99,
        "status": "pending",
        "createdAt": "2024-01-15T10:35:00Z"
      }
    },
    {
      "type": "state",
      "name": "OrderConfirmation",
      "tick": 70,
      "sourcedFrom": ["OrderCreated"],
      "example": {
        "orderId": "order-001",
        "message": "Thank you for your order!",
        "estimatedDelivery": "2024-01-18",
        "totalAmount": 79.99
      }
    },
    {
      "type": "state",
      "name": "PendingOrders",
      "tick": 80,
      "sourcedFrom": ["OrderCreated", "OrderPaid"],
      "example": {
        "orders": [
          { "orderId": "order-001", "customerId": "cust-789", "amount": 79.99, "status": "pending" }
        ]
      },
      "scenarios": [
        {
          "name": "List with one order",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            }
          ],
          "then": {
            "orders": [
              { "orderId": "order-001", "customerId": "cust-789", "amount": 79.99, "status": "pending" }
            ]
          }
        },
        {
          "name": "List with multiple orders",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            },
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-002",
                "customerId": "cust-790",
                "items": [
                  { "productId": "prod-457", "name": "Mouse Pad", "quantity": 2, "price": 19.99 }
                ],
                "totalAmount": 39.98,
                "status": "pending",
                "createdAt": "2024-01-15T11:00:00Z"
              }
            }
          ],
          "then": {
            "orders": [
              { "orderId": "order-001", "customerId": "cust-789", "amount": 79.99, "status": "pending" },
              { "orderId": "order-002", "customerId": "cust-790", "amount": 39.98, "status": "pending" }
            ]
          }
        },
        {
          "name": "Order is removed after payment",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            },
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            }
          ],
          "then": {
            "orders": []
          }
        }
      ]
    },
    {
      "type": "actor",
      "name": "PaymentProcessor",
      "tick": 90,
      "readsView": "PendingOrders",
      "sendsCommand": "ProcessPayment"
    },
    {
      "type": "command",
      "name": "ProcessPayment",
      "tick": 100,
      "example": {
        "orderId": "order-001",
        "amount": 79.99,
        "paymentMethod": "credit_card",
        "cardToken": "tok_visa_4242"
      },
      "scenarios": [
        {
          "name": "Successful payment",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            }
          ],
          "when": {
            "orderId": "order-001",
            "amount": 79.99,
            "paymentMethod": "credit_card",
            "cardToken": "tok_visa_4242"
          },
          "then": {
            "produces": [
              {
                "event": "OrderPaid",
                "data": {
                  "orderId": "order-001",
                  "paymentId": "pay-555",
                  "amount": 79.99,
                  "paidAt": "2024-01-15T10:36:00Z"
                }
              }
            ]
          }
        },
        {
          "name": "Failed payment - insufficient funds",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            }
          ],
          "when": {
            "orderId": "order-001",
            "amount": 79.99,
            "paymentMethod": "credit_card",
            "cardToken": "tok_visa_declined"
          },
          "then": {
            "produces": [
              {
                "event": "PaymentFailed",
                "data": {
                  "orderId": "order-001",
                  "reason": "Insufficient funds",
                  "failedAt": "2024-01-15T10:36:00Z"
                }
              }
            ]
          }
        },
        {
          "name": "Failed payment - invalid card",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            }
          ],
          "when": {
            "orderId": "order-001",
            "amount": 79.99,
            "paymentMethod": "credit_card",
            "cardToken": "tok_visa_invalid"
          },
          "then": {
            "produces": [
              {
                "event": "PaymentFailed",
                "data": {
                  "orderId": "order-001",
                  "reason": "Invalid card",
                  "failedAt": "2024-01-15T10:36:00Z"
                }
              }
            ]
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "OrderPaid",
      "tick": 110,
      "producedBy": "ProcessPayment-100",
      "example": {
        "orderId": "order-001",
        "paymentId": "pay-555",
        "amount": 79.99,
        "paidAt": "2024-01-15T10:36:00Z"
      }
    },
    {
      "type": "event",
      "name": "PaymentFailed",
      "tick": 120,
      "producedBy": "ProcessPayment-100",
      "example": {
        "orderId": "order-001",
        "reason": "Insufficient funds",
        "failedAt": "2024-01-15T10:36:00Z"
      }
    },
    {
      "type": "state",
      "name": "OrdersReadyToShip",
      "tick": 130,
      "sourcedFrom": ["OrderPaid", "OrderShipped"],
      "example": {
        "orders": [
          { "orderId": "order-001", "customerId": "cust-789", "paidAt": "2024-01-15T10:36:00Z" }
        ]
      },
      "scenarios": [
        {
          "name": "List with orders ready to ship",
          "given": [
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            },
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-002",
                "paymentId": "pay-556",
                "amount": 39.98,
                "paidAt": "2024-01-15T11:00:00Z"
              }
            }
          ],
          "then": {
            "orders": [
              { "orderId": "order-001", "customerId": "cust-789", "paidAt": "2024-01-15T10:36:00Z" },
              { "orderId": "order-002", "customerId": "cust-790", "paidAt": "2024-01-15T11:00:00Z" }
            ]
          }
        },
        {
          "name": "Order is removed after shipping",
          "given": [
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            },
            {
              "event": "OrderShipped",
              "data": {
                "orderId": "order-001",
                "trackingNumber": "DHL-123456789",
                "carrier": "DHL",
                "shippedAt": "2024-01-16T14:00:00Z"
              }
            }
          ],
          "then": {
            "orders": []
          }
        }
      ]
    },
    {
      "type": "actor",
      "name": "WarehouseWorker",
      "tick": 140,
      "readsView": "OrdersReadyToShip",
      "sendsCommand": "ShipOrder"
    },
    {
      "type": "command",
      "name": "ShipOrder",
      "tick": 150,
      "example": {
        "orderId": "order-001",
        "trackingNumber": "DHL-123456789",
        "carrier": "DHL"
      },
      "scenarios": [
        {
          "name": "Successful shipment of paid order",
          "given": [
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            }
          ],
          "when": {
            "orderId": "order-001",
            "trackingNumber": "DHL-123456789",
            "carrier": "DHL"
          },
          "then": {
            "produces": [
              {
                "event": "OrderShipped",
                "data": {
                  "orderId": "order-001",
                  "trackingNumber": "DHL-123456789",
                  "carrier": "DHL",
                  "shippedAt": "2024-01-16T14:00:00Z"
                }
              }
            ]
          }
        },
        {
          "name": "Reject unpaid order",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            }
          ],
          "when": {
            "orderId": "order-001",
            "trackingNumber": "DHL-123456789",
            "carrier": "DHL"
          },
          "then": {
            "fails": "Order has not been paid yet"
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "OrderShipped",
      "tick": 160,
      "producedBy": "ShipOrder-150",
      "example": {
        "orderId": "order-001",
        "trackingNumber": "DHL-123456789",
        "carrier": "DHL",
        "shippedAt": "2024-01-16T14:00:00Z"
      }
    },
    {
      "type": "state",
      "name": "CustomerOrderTracking",
      "tick": 170,
      "sourcedFrom": ["OrderCreated", "OrderPaid", "OrderShipped", "OrderDelivered"],
      "example": {
        "orderId": "order-001",
        "status": "shipped",
        "trackingNumber": "DHL-123456789",
        "timeline": [
          { "status": "created", "at": "2024-01-15T10:35:00Z" },
          { "status": "paid", "at": "2024-01-15T10:36:00Z" },
          { "status": "shipped", "at": "2024-01-16T14:00:00Z" }
        ]
      },
      "scenarios": [
        {
          "name": "Tracking after order creation",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            }
          ],
          "then": {
            "orderId": "order-001",
            "status": "created",
            "timeline": [
              { "status": "created", "at": "2024-01-15T10:35:00Z" }
            ]
          }
        },
        {
          "name": "Tracking after payment",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            },
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            }
          ],
          "then": {
            "orderId": "order-001",
            "status": "paid",
            "timeline": [
              { "status": "created", "at": "2024-01-15T10:35:00Z" },
              { "status": "paid", "at": "2024-01-15T10:36:00Z" }
            ]
          }
        },
        {
          "name": "Tracking after shipment",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            },
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            },
            {
              "event": "OrderShipped",
              "data": {
                "orderId": "order-001",
                "trackingNumber": "DHL-123456789",
                "carrier": "DHL",
                "shippedAt": "2024-01-16T14:00:00Z"
              }
            }
          ],
          "then": {
            "orderId": "order-001",
            "status": "shipped",
            "trackingNumber": "DHL-123456789",
            "timeline": [
              { "status": "created", "at": "2024-01-15T10:35:00Z" },
              { "status": "paid", "at": "2024-01-15T10:36:00Z" },
              { "status": "shipped", "at": "2024-01-16T14:00:00Z" }
            ]
          }
        },
        {
          "name": "Tracking after delivery",
          "given": [
            {
              "event": "OrderCreated",
              "data": {
                "orderId": "order-001",
                "customerId": "cust-789",
                "items": [
                  { "productId": "prod-456", "name": "Wireless Keyboard", "quantity": 1, "price": 79.99 }
                ],
                "totalAmount": 79.99,
                "status": "pending",
                "createdAt": "2024-01-15T10:35:00Z"
              }
            },
            {
              "event": "OrderPaid",
              "data": {
                "orderId": "order-001",
                "paymentId": "pay-555",
                "amount": 79.99,
                "paidAt": "2024-01-15T10:36:00Z"
              }
            },
            {
              "event": "OrderShipped",
              "data": {
                "orderId": "order-001",
                "trackingNumber": "DHL-123456789",
                "carrier": "DHL",
                "shippedAt": "2024-01-16T14:00:00Z"
              }
            },
            {
              "event": "OrderDelivered",
              "data": {
                "orderId": "order-001",
                "deliveredAt": "2024-01-18T11:23:00Z",
                "signature": "M. Mustermann"
              }
            }
          ],
          "then": {
            "orderId": "order-001",
            "status": "delivered",
            "trackingNumber": "DHL-123456789",
            "timeline": [
              { "status": "created", "at": "2024-01-15T10:35:00Z" },
              { "status": "paid", "at": "2024-01-15T10:36:00Z" },
              { "status": "shipped", "at": "2024-01-16T14:00:00Z" },
              { "status": "delivered", "at": "2024-01-18T11:23:00Z" }
            ]
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "OrderDelivered",
      "tick": 180,
      "externalSource": "Carrier Webhook",
      "example": {
        "orderId": "order-001",
        "deliveredAt": "2024-01-18T11:23:00Z",
        "signature": "M. Mustermann"
      }
    }
  ]
}
