{
  "$schema": "../information-flow.schema.json",
  "name": "Todo App",
  "description": "A simple todo application for managing tasks",
  "version": "1.0.0",

  "timeline": [
    {
      "type": "state",
      "name": "TodoList",
      "tick": 1,
      "sourcedFrom": ["TodoCreated", "TodoCompleted", "TodoDeleted"],
      "example": {
        "todos": []
      },
      "scenarios": [
        {
          "name": "Empty list without events",
          "given": [],
          "then": {
            "todos": []
          }
        },
        {
          "name": "One open todo after creation",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "todo-1", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            }
          ],
          "then": {
            "todos": [
              { "id": "todo-1", "title": "Go shopping", "completed": false }
            ]
          }
        },
        {
          "name": "Completed todo is marked",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "todo-1", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            },
            {
              "event": "TodoCompleted",
              "data": { "todoId": "todo-1", "completedAt": "2025-12-02T11:00:00Z" }
            }
          ],
          "then": {
            "todos": [
              { "id": "todo-1", "title": "Go shopping", "completed": true }
            ]
          }
        },
        {
          "name": "Deleted todo disappears from list",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "todo-1", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            },
            {
              "event": "TodoDeleted",
              "data": { "todoId": "todo-1", "deletedAt": "2025-12-02T12:00:00Z" }
            }
          ],
          "then": {
            "todos": []
          }
        },
        {
          "name": "Multiple todos with mixed status",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "todo-1", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            },
            {
              "event": "TodoCreated",
              "data": { "id": "todo-2", "title": "Do exercise", "createdAt": "2025-12-02T10:05:00Z" }
            },
            {
              "event": "TodoCompleted",
              "data": { "todoId": "todo-1", "completedAt": "2025-12-02T11:00:00Z" }
            }
          ],
          "then": {
            "todos": [
              { "id": "todo-1", "title": "Go shopping", "completed": true },
              { "id": "todo-2", "title": "Do exercise", "completed": false }
            ]
          }
        }
      ]
    },
    {
      "type": "actor",
      "name": "User",
      "tick": 2,
      "readsView": "TodoList",
      "sendsCommand": "CreateTodo"
    },
    {
      "type": "command",
      "name": "CreateTodo",
      "tick": 3,
      "example": {
        "title": "Go shopping"
      },
      "scenarios": [
        {
          "name": "Successfully create todo",
          "given": [],
          "when": {
            "title": "Go shopping"
          },
          "then": {
            "produces": [
              {
                "event": "TodoCreated",
                "data": { "id": "generated-id", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
              }
            ]
          }
        },
        {
          "name": "Reject empty title",
          "given": [],
          "when": {
            "title": ""
          },
          "then": {
            "fails": "Title cannot be empty"
          }
        },
        {
          "name": "Reject title that is too long",
          "given": [],
          "when": {
            "title": "This is a very long title that exceeds the maximum character limit of 200 characters and should therefore be rejected by the system because it is simply no longer readable and makes no sense at all"
          },
          "then": {
            "fails": "Title cannot exceed 200 characters"
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "TodoCreated",
      "tick": 4,
      "producedBy": "CreateTodo-3",
      "example": {
        "id": "abc-123",
        "title": "Go shopping",
        "createdAt": "2025-12-02T10:00:00Z"
      }
    },

    {
      "type": "state",
      "name": "TodoList",
      "tick": 5,
      "sourcedFrom": ["TodoCreated", "TodoCompleted", "TodoDeleted"],
      "example": {
        "todos": [
          { "id": "abc-123", "title": "Go shopping", "completed": false }
        ]
      }
    },
    {
      "type": "actor",
      "name": "User",
      "tick": 6,
      "readsView": "TodoList",
      "sendsCommand": "CompleteTodo"
    },
    {
      "type": "command",
      "name": "CompleteTodo",
      "tick": 7,
      "example": {
        "todoId": "abc-123"
      },
      "scenarios": [
        {
          "name": "Successfully complete todo",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "abc-123", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            }
          ],
          "when": {
            "todoId": "abc-123"
          },
          "then": {
            "produces": [
              {
                "event": "TodoCompleted",
                "data": { "todoId": "abc-123", "completedAt": "2025-12-02T11:00:00Z" }
              }
            ]
          }
        },
        {
          "name": "Reject when todo does not exist",
          "given": [],
          "when": {
            "todoId": "non-existent"
          },
          "then": {
            "fails": "Todo not found"
          }
        },
        {
          "name": "Reject when todo already completed",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "abc-123", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            },
            {
              "event": "TodoCompleted",
              "data": { "todoId": "abc-123", "completedAt": "2025-12-02T11:00:00Z" }
            }
          ],
          "when": {
            "todoId": "abc-123"
          },
          "then": {
            "fails": "Todo is already completed"
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "TodoCompleted",
      "tick": 8,
      "producedBy": "CompleteTodo-7",
      "example": {
        "todoId": "abc-123",
        "completedAt": "2025-12-02T11:00:00Z"
      }
    },

    {
      "type": "state",
      "name": "TodoList",
      "tick": 9,
      "sourcedFrom": ["TodoCreated", "TodoCompleted", "TodoDeleted"],
      "example": {
        "todos": [
          { "id": "abc-123", "title": "Go shopping", "completed": true }
        ]
      }
    },
    {
      "type": "actor",
      "name": "User",
      "tick": 10,
      "readsView": "TodoList",
      "sendsCommand": "DeleteTodo"
    },
    {
      "type": "command",
      "name": "DeleteTodo",
      "tick": 11,
      "example": {
        "todoId": "abc-123"
      },
      "scenarios": [
        {
          "name": "Successfully delete todo",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "abc-123", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            }
          ],
          "when": {
            "todoId": "abc-123"
          },
          "then": {
            "produces": [
              {
                "event": "TodoDeleted",
                "data": { "todoId": "abc-123", "deletedAt": "2025-12-02T12:00:00Z" }
              }
            ]
          }
        },
        {
          "name": "Reject when todo does not exist",
          "given": [],
          "when": {
            "todoId": "non-existent"
          },
          "then": {
            "fails": "Todo not found"
          }
        },
        {
          "name": "Completed todos can also be deleted",
          "given": [
            {
              "event": "TodoCreated",
              "data": { "id": "abc-123", "title": "Go shopping", "createdAt": "2025-12-02T10:00:00Z" }
            },
            {
              "event": "TodoCompleted",
              "data": { "todoId": "abc-123", "completedAt": "2025-12-02T11:00:00Z" }
            }
          ],
          "when": {
            "todoId": "abc-123"
          },
          "then": {
            "produces": [
              {
                "event": "TodoDeleted",
                "data": { "todoId": "abc-123", "deletedAt": "2025-12-02T12:00:00Z" }
              }
            ]
          }
        }
      ]
    },
    {
      "type": "event",
      "name": "TodoDeleted",
      "tick": 12,
      "producedBy": "DeleteTodo-11",
      "example": {
        "todoId": "abc-123",
        "deletedAt": "2025-12-02T12:00:00Z"
      }
    }
  ]
}
